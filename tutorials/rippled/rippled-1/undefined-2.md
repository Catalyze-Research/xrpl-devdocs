# 온라인 삭제 구성

기본 구성에서 rippled 서버는 가장 최근의 2000개 ledger 버전보다 오래된 기록을 삭제하며, 약 15분 분량의 ledger 기록을 보관합니다(현재 ledger 간 전송 속도 기준). 이 페이지에서는 rippled 서버가 삭제하기 전에 저장하는 기록의 양을 구성하는 방법을 설명합니다.

## 요구 조건

이 튜토리얼에서는 서버가 다음 요구 조건을 충족한다고 가정합니다:

* 지원되는 운영 체제를 사용 중입니다: 우분투 리눅스, 레드햇 엔터프라이즈 리눅스(RHEL) 또는 CentOS.
* rippled 서버가 이미 설치되어 있고 온라인 삭제가 활성화되어 있습니다. 권장 플랫폼에 대한 설치 지침을 따랐다면 온라인 삭제가 기본적으로 사용 설정되어 있습니다.
* 서버에 선택한 양의 기록을 ledger 저장소에 저장할 수 있는 충분한 디스크 공간이 있습니다.

## 구성 단계

서버에 저장할 기록의 양을 변경하려면 다음 단계를 수행합니다:

1. 몇 개의 ledger 버전에 해당하는 히스토리를 저장할지 결정합니다.\
   새 ledger 버전은 일반적으로 3\~4초 간격으로 유효성이 검사되므로 ledger 버전 수는 저장하려는 시간과 대략 일치합니다. 다양한 구성에 필요한 저장 용량에 대한 자세한 내용은 용량 계획을 참조하세요.\
   온라인 삭제는 기록을 삭제한 후 보관할 ledger 버전 수를 기준으로 하므로, 보관하도록 설정한 ledger의 두 배에 해당하는 ledger를 저장할 수 있는 충분한 디스크 공간이 있어야 합니다.
2. rippled의 구성 파일에서 \[node\_db] 구의 online\_delete 필드를 편집합니다.

```
[node_db]
# Other settings unchanged ...
online_delete=2000
advisory_delete=0
```

온라인 삭제를 실행한 후 보관할 최소 ledger 버전 수로 online\_delete를 설정합니다. 자동 삭제(기본값)를 사용하면 서버는 일반적으로 이보다 두 배 정도 많은 ledger 버전이 누적되면 삭제를 실행합니다.\
권장 설치는 기본적으로 구성 파일 /etc/opt/ripple/rippled.cfg를 사용합니다. \
구성 파일을 저장할 수 있는 다른 위치로는 $HOME/.config/ripple/rippled.cfg(여기서 $HOME은 ripppled를 실행하는 사용자의 홈 디렉터리), $HOME/.local/ripple/rippled.cfg 또는 ripppled를 시작한 현재 작업 디렉터리 등이 있습니다.

3. rippled 서비스를 시작(또는 다시 시작)합니다.

```
$ sudo systemctl restart rippled
```

4. 서버가 네트워크에 동기화될 때까지 기다립니다.\
   네트워크 및 시스템 성능과 서버가 오프라인 상태였던 시간에 따라 완전히 동기화되는 데 5분에서 15분 정도 걸릴 수 있습니다.\
   서버가 네트워크와 동기화되면 server\_info 메소드가 서버 상태 값을 "full", "proposing" 또는 "validating"으로 보고합니다.
5. server\_info 메소드를 사용하여 서버의 complete\_ledgers 범위를 주기적으로 확인하여 장부가 삭제되고 있는지 확인하세요.\
   온라인 삭제가 실행된 후 complete\_ledgers 범위는 이전 ledger을 더 이상 사용할 수 없음을 반영합니다. 서버에 기록이 누적됨에 따라 사용 가능한 총 장부 수는 구성한 online\_delete 값의 두 배까지 서서히 증가하다가 온라인 삭제가 실행되면 감소합니다.
6. rippled 로그에서 SHAMapStore::WRN으로 시작하는 메시지가 있는지 모니터링하세요. 이는 서버가 네트워크와 동기화되지 않아 온라인 삭제가 중단되고 있음을 나타낼 수 있습니다.\
   이런 일이 자주 발생한다면 온라인 삭제를 실행하는 동안 서버가 ledger을 따라잡기에 충분한 사양을 갖추지 못한 것일 수 있습니다. 동일한 하드웨어의 다른 서비스(예: 예약된 백업 또는 보안 스캔)가 rippled 서버와 리소스를 놓고 경쟁하고 있지 않은지 확인하세요. 다음 중 하나를 시도해 보세요.

* 시스템 사양을 높입니다. 권장 사항은 시스템 요구 사항을 참조하세요.
* 기록을 적게 저장하도록 구성을 변경합니다. (이 튜토리얼의 2단계).
* 서버의 node\_size 매개변수를 변경합니다.
* ledger 저장소에 RocksDB 대신 NuDB를 사용합니다.
* 권고 삭제를 사용하여 온라인 삭제를 예약합니다.
