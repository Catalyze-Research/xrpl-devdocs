# 비공개 서버 구성

비공개 서버는 개방형 P2P 네트워크에서 발견된 피어에 직접 연결하는 대신 신뢰할 수 있는 특정 피어를 통해서만 네트워크에 연결되는 rippled 서버입니다. 이러한 종류의 구성은 유효성 검증인에 가장 일반적으로 권장되는 선택적 예방 조치이지만 다른 특정 목적에 유용할 수 있습니다.

## 요구 조건

비공개 서버를 사용하려면 다음 요구 사항을 충족해야 합니다:

* rippled가 설치되어 있고 최신 버전으로 업데이트 되었지만 아직 실행 중이 아니어야 합니다.
* 직접 실행하는 프록시를 통해 연결할지 아니면 공용 허브를 통해 연결할지 결정해야 합니다. 이러한 옵션의 비교는 피어링 구성의 장단점을 참조하세요.
  * 프록시를 사용하는 경우 프록시로 사용할 rippled가 설치되어 실행 중인 추가 컴퓨터가 있어야 합니다. 이러한 서버는 외부 네트워크 및 비공개 서버에 연결할 수 있어야 합니다.
  * 두 구성 모두 연결하려는 피어의 IP 주소와 포트를 알고 있어야 합니다.

## 단계

특정 서버를 비공개 피어로 설정하려면 다음 단계를 완료하세요:

1. rippled의 구성 파일을 편집합니다.

```
vim /etc/opt/ripple/rippled.cfg
```

권장 설치는 기본적으로 구성 파일 /etc/opt/ripple/rippled.cfg를 사용합니다. 구성 파일을 저장할 수 있는 다른 위치로는 $HOME/.config/ripple/rippled.cfg(여기서 $HOME은 rippled를 실행하는 사용자의 홈 디렉터리), $HOME/.local/ripple/rippled.cfg 또는 rippled를 시작한 현재 작업 디렉터리 등이 있습니다.

2. 비공개 피어링을 활성화합니다.\
   구성 파일에서 다음 구절을 추가하거나 주석 처리합니다:

```
[peer_private]
1
```

3. 고정 피어를 추가합니다.\
   구성 파일에 \[ips\_fixed] 구절을 추가하거나 주석 처리를 해제합니다. 이 구절의 각 줄에는 연결할 피어의 호스트 이름 또는 IP 주소가 있어야 하며, 그 뒤에 공백과 이 피어가 피어 프로토콜 연결을 수락하는 포트가 있어야 합니다.\
   예를 들어 공용 허브를 사용하여 연결하려면 다음 구를 사용할 수 있습니다:

```
[ips_fixed]
r.ripple.com 51235
zaphod.alloy.ee 51235
```

서버가 프록시를 사용하여 연결하는 경우 IP 주소와 포트는 프록시로 사용 중인 rippled 서버의 구성과 일치해야 합니다. 각 서버의 포트 번호는 해당 서버의 구성 파일에 있는 protocol = peer 포트(일반적으로 51235)와 일치해야 합니다. 예를 들어 구성은 다음과 같을 수 있습니다:

```
[ips_fixed]
192.168.0.1 51235
192.168.0.2 51235
```

{% hint style="info" %}
Note:

포트 번호를 생략하면 서버는 XRP Ledger 프로토콜을 위해 IANA에서 할당된 포트인 2459 포트를 사용합니다. [![New in: rippled 1.6.0](https://img.shields.io/badge/New%20in-rippled%201.6.0-blue.svg) ](https://github.com/ripple/rippled/releases/tag/1.6.0)
{% endhint %}

4. 프록시를 사용하는 경우, 프라이빗 피어와 서로 클러스터링하세요.\
   퍼블릭 허브를 사용 중이라면 이 단계를 건너뛰세요.\
   프록시를 사용하는 경우, 프록시를 프라이빗 피어를 포함하는 클러스터로 구성하세요. 클러스터의 각 구성원은 클러스터의 다른 구성원을 나열하는 \[ips\_fixed] 구절를 가져야 합니다. 단, 프라이빗 서버에만 \[peer\_private] 구절이 있어야 합니다.\
   프록시에서 하나씩 rippled를 다시 시작합니다. 각 프록시 서버에서:

```
sudo service systemctl restart rippled
```

5. 프라이빗 서버에서 rippled를 시작합니다.

```
sudo service systemctl start rippled
```

6. 피어 메소드를 사용하여 프라이빗 서버가 해당 피어에만 연결되어 있는지 확인합니다.\
   응답의 피어 배열에 주소가 구성된 피어 중 하나가 아닌 객체가 포함되어서는 안 됩니다. 그렇지 않은 경우 구성 파일을 다시 확인하고 프라이빗 서버를 다시 시작하세요.

## 다음 단계

추가 예방 조치로, 특정 피어가 아닌 서버에서 프라이빗 서버로 들어오는 연결을 차단하도록 방화벽을 구성해야 합니다. 프록시 서버를 실행하는 경우 방화벽을 통해 피어 포트를 프록시로 전달하되 비공개 피어에는 전달하지 마세요. 이를 구성하는 방법에 대한 정확한 세부 사항은 사용하는 방화벽에 따라 다릅니다.

방화벽이 포트 80에서 나가는 HTTP 연결을 차단하지 않는지 확인하세요. 기본 구성은 이 포트를 사용하여 vl.ripple.com에서 최신 권장 유효성 검증인 목록을 다운로드합니다. 유효성 검증인 목록이 없으면 서버는 신뢰할 유효성 검증인을 알지 못하며 네트워크가 컨센서스에 도달할 때 이를 인식할 수 없습니다.
