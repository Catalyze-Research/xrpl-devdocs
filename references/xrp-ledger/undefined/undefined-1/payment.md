# Payment

결제 트랜잭션은 한 계정에서 다른 계정으로 가치가 이전되는 것을 의미합니다. (이동 경로에 따라 원자 단위로 발생하는 추가적인 가치 교환이 포함될 수 있습니다.) 이 거래 유형은 여러 유형의 결제에 사용할 수 있습니다.

결제는 계정을 만드는 유일한 방법이기도 합니다.

## 결제 JSON 예시

```
{
  "TransactionType" : "Payment",
  "Account" : "rf1BiGeXwwQoi8Z2ueFYTEXSwuJYfV2Jpn",
  "Destination" : "ra5nK24KXen9AHvsdFTKHSANinZseWnPcX",
  "Amount" : {
     "currency" : "USD",
     "value" : "1",
     "issuer" : "rf1BiGeXwwQoi8Z2ueFYTEXSwuJYfV2Jpn"
  },
  "Fee": "12",
  "Flags": 2147483648,
  "Sequence": 2,
}
```

## 결제 필드

결제 거래에는 공통 필드 외에도 다음 필드가 사용됩니다:

| 필드             | JSON 유형                                                                     | [내부 유형](https://xrpl.org/serialization.html) | 설명                                                                                                                                                                                           |
| -------------- | --------------------------------------------------------------------------- | -------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Amount         | [화폐 금액](https://xrpl.org/basic-data-types.html#specifying-currency-amounts) | 금액                                           | 전달할 통화 금액입니다. XRP가 아닌 금액의 경우 중첩된 필드 이름은 반드시 소문자여야 합니다. tfPartialPayment 플래그가 설정되어 있으면 대신 이 금액까지만 전달합니다.                                                                                      |
| Destination    | 문자열                                                                         | 계정 ID                                        | 결제를 받을 계정의 고유 주소입니다.                                                                                                                                                                         |
| DestinationTag | 숫자                                                                          | UInt32                                       | (선택 사항) 목적지 또는 결제할 호스팅된 수취인에게 지급하는 이유를 식별하는 임의의 태그입니다.                                                                                                                                       |
| InvoiceID      | 문자열                                                                         | 해시256                                        | (선택 사항) 이 결제의 특정 이유 또는 식별자를 나타내는 임의의 256비트 해시입니다.                                                                                                                                            |
| Paths          | 경로 배열의 배열                                                                   | 경로 집합                                        | (선택 사항, 자동 채우기 가능) 이 거래에 사용할 결제 경로의 배열입니다. XRP 간 트랜잭션의 경우 생략해야 합니다.                                                                                                                          |
| SendMax        | [화폐 금액](https://xrpl.org/basic-data-types.html#specifying-currency-amounts) | 금액                                           | (선택 사항) 송금 수수료, 환율, 슬리피지를 포함하여 이 거래에 허용되는 소스 통화의 최대 금액입니다. 트랜잭션 제출 비용으로 소멸된 XRP는 포함되지 않습니다. XRP가 아닌 금액의 경우 중첩된 필드 이름은 반드시 소문자여야 합니다. 교차 통화/교차 발행 결제의 경우 반드시 입력해야 합니다. XRP 간 결제의 경우 생략해야 합니다. |
| DeliverMin     | [화폐 금액](https://xrpl.org/basic-data-types.html#specifying-currency-amounts) | 금액                                           | (선택 사항) 이 트랜잭션이 전달해야 하는 목적지 통화의 최소 금액입니다. 부분 결제인 경우에만 유효합니다. XRP가 아닌 금액의 경우 중첩된 필드 이름은 소문자입니다.                                                                                               |

## 결제 유형

결제 트랜잭션 유형은 여러 가지 유형의 추상 작업을 나타낼 수 있는 범용 도구입니다. 아래 표에 설명된 대로 트랜잭션의 필드를 기준으로 트랜잭션 유형을 식별할 수 있습니다:

| 지불 유형                                                         | `Amount`            | `SendMax`           | `Paths`  | `Address`= `Destination`? | 설명                                                                                                                                                                                                                                                                         |
| ------------------------------------------------------------- | ------------------- | ------------------- | -------- | ------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [XRP에서 XRP로 직접 결제](https://xrpl.org/direct-xrp-payments.html) | 문자열(XRP)            | 생략                  | 생략       | 아니요                       | XRP에서 XRP로 직접 결제 문자열(XRP) 생략 생략 없음 한 계정에서 다른 계정으로 XRP를 직접 이체하지 않습니다. 항상 정확한 금액을 전달합니다. 기본 거래 비용 외에는 수수료가 적용되지 않습니다.                                                                                                                                                        |
| [토큰 생성 또는 상환](https://xrpl.org/tokens.html)                   | 객체                  | 객체(선택사항)            | 선택 과목    | 아니요                       | XRP Ledger에 추적된 비XRP 통화 또는 자산의 금액을 늘리거나 줄입니다. 직접 송금 및 상환 시에는 송금 수수료와 동결이 적용되지 않습니다.                                                                                                                                                                                        |
| [교차 통화 결제](https://xrpl.org/cross-currency-payments.html)     | 객체(비XRP) / 문자열(XRP) | 객체(비XRP) / 문자열(XRP) | 일반적으로 필수 | 아니요                       | 한 홀더에서 다른 홀더로 토큰을 전송할 수 없습니다. 금액 또는 SendMax는 XRP 또는 토큰일 수 있지만 둘 다 XRP일 수는 없습니다. 이러한 결제는 발행자를 통해 파급되며, 트랜잭션에 경로 세트가 지정되어 있는 경우 여러 중개자를 통해 더 긴 경로를 거칠 수 있습니다. 이러한 유형의 거래에는 발행자가 설정한 이체 수수료가 적용됩니다. 이러한 트랜잭션은 탈중앙화 거래소에서 오퍼를 사용해 서로 다른 통화 간 또는 통화 코드가 같고 발행자가 다른 통화 간에 연결합니다. |
| [부분 결제](https://xrpl.org/partial-payments.html)               | 객체(비XRP) / 문자열(XRP) | 객체(비XRP) / 문자열(XRP) | 일반적으로 필수 | 아니요                       | 모든 통화로 전송합니다. tfPartialPayment 플래그를 사용합니다. 트랜잭션이 성공하기 위해 송금해야 하는 최소 금액을 지정하는 DeliverMin 금액을 포함할 수 있으며, 트랜잭션에 DeliverMin이 지정되지 않은 경우 양수 금액을 송금해도 성공할 수 있습니다.                                                                                                                |
| 통화 변환                                                         | 객체(비XRP) / 문자열(XRP) | 객체(비XRP) / 문자열(XRP) | 필수       | 예                         | 탈중앙화 거래소에서 오퍼를 소비하여 한 통화를 다른 통화로 변환하여 차익거래 기회를 잡을 수 있습니다. 금액과 SendMax는 모두 XRP일 수 없습니다. 송금인에게 돈을 전달하기 때문에 순환 결제라고도 합니다. 데이터 API는 이러한 유형의 거래를 '결제'가 아닌 '교환'으로 추적합니다.                                                                                                         |

## SendMax 및 금액에 대한 특수 발행자 값

대부분의 경우, XRP가 아닌 화폐 금액의 발행자 필드는 토큰의 발행자를 나타냅니다. 그러나 결제를 설명할 때는 결제의 금액과 SendMax 필드에 있는 발행자 필드에 특별한 규칙이 있습니다.

* 동일한 화폐 코드에 대해 두 주소 간에는 잔액이 하나만 있을 수 있습니다. 즉, 금액의 발행자 필드가 토큰을 발행한 주소가 아닌 트랜잭션 상대방을 가리키는 경우가 있습니다.
* 목적지 금액 필드의 발행자 필드가 목적지 주소와 일치하면 "목적지가 수락하는 모든 발행자"를 의미하는 특수한 경우로 취급됩니다. 여기에는 대상 주소에 양수 한도의 신뢰선이 있는 모든 주소와 대상 주소에서 발행한 화폐 코드가 동일한 토큰이 포함됩니다.
* SendMax 필드의 발행자 필드가 소스 계정의 주소와 일치하면 "소스가 사용할 수 있는 모든 발행자"를 의미하는 특수한 경우로 취급됩니다. 여기에는 다른 계정이 소스 계정으로 확장한 신뢰선에 새 토큰을 만들고 소스 계정이 다른 발행자로부터 보유한 토큰을 전송하는 것이 포함됩니다.

## 계정 만들기

결제 트랜잭션 유형은 자금이 입금되지 않은 주소로 충분한 XRP를 송금하여 XRP Ledger에 새 계정을 만들 수 있습니다. 미송금 주소로의 다른 트랜잭션은 항상 실패합니다.

자세한 내용은 계정을 참조하세요.

## 경로

경로가 있는 경우, 경로 필드에는 경로 집합(경로 배열)이 포함되어야 합니다. 각 개별 경로는 다양한 중개 계정과 오더북을 통해 발신자에서 수신자로 값이 이동할 수 있는 한 가지 방법을 나타냅니다. 예를 들어 최적의 환율을 얻기 위해 여러 개의 오더북을 사용하여 화폐를 교환하는 경우처럼 단일 트랜잭션에 여러 경로를 사용할 수 있습니다.

다음을 포함한 직접 결제의 경우 경로 필드를 생략해야 합니다:

* XRP에서 XRP로 이체.
* 발신자와 수신자를 연결하는 신뢰선을 통한 직접 이체.

경로 필드를 제공하면 서버는 트랜잭션 처리 시점에 제공된 세트와 기본 경로(지정된 계정을 연결하는 가장 직접적인 방법) 중에서 사용할 경로를 결정합니다. 이 결정은 결정론적이며 비용을 최소화하려고 시도하지만 완벽하다고 보장할 수는 없습니다.

Paths 필드는 빈 배열이 아니어야 하며, 멤버가 모두 빈 배열인 배열도 아니어야 합니다.

자세한 내용은 경로를 참조하십시오.

## 결제 플래그

결제 유형의 트랜잭션은 다음과 같이 플래그 필드에 추가 값을 지원합니다:

| 플래그 이름             | 16진수 값       | 소수점 값  | 설명                                                                                         |
| ------------------ | ------------ | ------ | ------------------------------------------------------------------------------------------ |
| `tfNoDirectRipple` | `0x00010000` | 65536  | 기본 경로를 사용하지 말고 경로 필드에 포함된 경로만 사용하세요. 이는 거래가 차익거래 기회를 갖도록 강제하기 위한 것입니다. 대부분의 고객은 필요하지 않습니다. |
| `tfPartialPayment` | `0x00020000` | 131072 | 지정된 금액을 SendMax보다 많이 쓰지 않고도 송금할 수 없는 경우 완전히 실패하지 않고 수신 금액을 줄입니다. 자세한 내용은 부분 결제를 참조하세요.     |
| `tfLimitQuality`   | `0x00040000` | 262144 | 모든 전환의 입력:출력 비율이 Amount:SendMax 비율과 같거나 더 좋은 경로만 사용합니다. 자세한 내용은 품질 제한을 참조하십시오.             |

## 부분 결제

부분 결제를 사용하면 수령 금액을 줄여서 결제가 성공할 수 있습니다. 부분 결제는 추가 비용을 발생시키지 않고 결제를 반환하는 데 유용합니다. 그러나 부분 결제는 성공적인 트랜잭션의 금액 필드에 항상 정확한 금액이 표시된다고 순진하게 가정하는 통합을 악용하는 데 사용될 수도 있습니다.

부분 결제는 tfPartialPayment 플래그가 활성화된 모든 결제 트랜잭션입니다. 부분 결제는 SendMax 값보다 많은 금액을 전송하지 않고 DeliverMin 필드보다 크거나 같은 양수 금액(DeliverMin이 지정되지 않은 경우 전혀 양수 금액)을 전송하는 경우 성공할 수 있습니다.

결제 메타데이터의 delivered\_amount 필드는 대상 계정에서 실제로 수령한 화폐 금액을 나타냅니다.

자세한 내용은 부분 결제에 대한 전체 문서를 참조하세요.

## 품질 제한

XRP Ledger은 환전소의 "품질"을 들어오는 숫자와 나가는 숫자의 비율로 정의합니다. 예를 들어, 2달러를 사용해 1파운드(GBP)를 받는다면 해당 환전소의 "품질"은 0.5입니다.

tfLimitQuality 플래그를 사용하면 수락할 수 있는 최소 전환 품질을 설정할 수 있습니다. 이 제한 품질은 목적지 금액을 SendMax 금액으로 나눈 값으로 정의됩니다(화폐와 관계없이 숫자 금액만 해당). 설정하면 결제 처리 엔진은 품질(전환율)이 한도 품질보다 더 나쁜(수치상 더 낮은) 경로를 사용하지 않습니다.

tfLimitQuality 플래그는 그 자체로 트랜잭션이 성공할 수 있는 상황의 수를 줄입니다. 구체적으로, 결제의 전체 평균 전환 품질이 한도 품질과 같거나 더 좋더라도 결제의 일부가 불리한 전환을 사용하는 경우 결제를 거부합니다. 이러한 방식으로 결제가 거부되면 트랜잭션 결과는 tecPATH\_DRY입니다.

다음 예를 살펴보겠습니다. 100중국 위안(금액 = 100 CNY)을 20미국 달러(SendMax = 20 USD) 이하로 보내려고 하는 경우 한도 품질은 5입니다. 한 트레이더가 15달러에 95엔(비율은 USD당 약 6.3 CNY)을 제안하지만 시장에서 가장 좋은 제안은 2달러에 5엔(비율은 USD당 2.5 CNY)이라고 가정해 보겠습니다. 두 제안을 모두 받아들여 100 CNY를 송금한다면 평균 품질은 약 5.9로 17 USD가 소요됩니다.

tfLimitQuality 플래그가 설정되어 있지 않은 경우 이 트랜잭션은 17달러의 비용이 지정된 SendMax 이내이므로 성공할 것입니다. 그러나 tfLimitQuality 플래그를 설정하면 두 번째 제안을 받는 경로의 품질이 2.5로 제한 품질인 5보다 낮기 때문에 트랜잭션이 대신 실패합니다.

tfLimitQuality 플래그는 부분 결제와 함께 사용할 때 가장 유용합니다. 트랜잭션에 tfPartialPayment 및 tfLimitQuality가 모두 설정되어 있으면 트랜잭션은 한도 품질보다 낮은 전환을 사용하지 않고 대상 금액의 최대한 많은 금액을 전달합니다.

위의 예에서 95엔/$15 제안과 5엔/$2 제안이 있는 경우, 내 트랜잭션에 tfPartialPayment와 tfLimitQuality가 모두 활성화되어 있는 경우에는 상황이 달라집니다. SendMax를 20달러로 유지하고 목적지 금액을 100위안으로 유지하면 한도 품질은 여전히 5입니다. 그러나 부분 결제를 하기 때문에 목적지 금액 전체를 송금할 수 없는 경우 트랜잭션이 실패하는 대신 가능한 한 많은 금액을 송금합니다. 즉, 내 트랜잭션은 품질이 약 6.3인 95/$15 제안을 사용하지만 해당 제안의 품질이 2.5로 품질 한도인 5보다 낮기 때문에 5/$2 제안은 거부됩니다. 결국 트랜잭션은 전체 100엔이 아닌 95엔만 전달되지만, 낮은 환율로 인한 비용 낭비를 방지할 수 있습니다.

&#x20;
