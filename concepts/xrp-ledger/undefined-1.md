# 피어 프로토콜

XRP Ledger의 서버들은 XRP Ledger 피어 프로토콜을 사용하여 서로 통신합니다.

피어 프로토콜은 XRP Ledger의 서버들 간의 주요 통신 방식입니다. XRP Ledger의 동작, 진행 상황 및 연결 상태에 관한 모든 정보는 피어 프로토콜을 통해 전달됩니다. 피어 간 통신의 예시로는 다음과 같은 것들이 있습니다:

* P2P 네트워크에서 다른 서버들과의 연결을 요청하거나 연결 슬롯의 가용성을 알리는 것.
* 후보 트랜잭션을 네트워크의 나머지 부분과 공유하는 것.
* 과거 ledger에서 ledger 데이터를 요청하거나 해당 데이터를 제공하는 것.
* 일련의 트랜잭션을 컨센서스를 위해 제안하거나 컨센서스 트랜잭션 세트의 적용 결과를 공유하는 것.

피어간 연결을 설정하기 위해 한 서버가 다른 서버에 HTTPS를 통해 연결하고 [HTTP 업그레이드](https://datatracker.ietf.org/doc/html/rfc7230#section-6.7)를 요청하여 <mark style="background-color:yellow;">XRPL/2.0</mark> 프로토콜(이전에는 <mark style="background-color:yellow;">RTXP/1.2</mark>)로 전환합니다. (자세한 정보는 [rippled repository](https://github.com/XRPLF/rippled)의 [Overlay Network](https://github.com/XRPLF/rippled/blob/96bbabbd2ece106779bb544aa0e4ce174e99fdf6/src/ripple/overlay/README.md#handshake) 문서를 참조하세요.)

## 피어 검색&#x20;

XRP Ledger는 "gossip" 프로토콜을 사용하여 XRP Ledger 네트워크에서 서로 연결할 다른 서버를 찾는 데 도움을 줍니다. 서버가 시작될 때마다 이전에 연결되었던 다른 피어들과 다시 연결합니다. 이후에는 [하드코딩된 공개 허브](https://github.com/XRPLF/rippled/blob/fa57859477441b60914e6239382c6fba286a0c26/src/ripple/overlay/impl/OverlayImpl.cpp#L518-L525)를 대안으로 사용합니다. 서버가 피어에 성공적으로 연결되면 해당 피어에게 피어를 찾고 있는 다른 XRP Ledger 서버들의 연락처 정보(일반적으로 IP 주소와 포트)를 요청합니다. 서버는 이후 해당 서버들과 연결하고, 그 서버들로부터 더 많은 XRP Ledger 서버들의 연락처 정보를 요청할 수 있습니다. 이 과정을 통해 서버는 어떤 단일 피어와의 연결이 끊어져도 신뢰할 수 있게 네트워크 전체에 연결될 수 있습니다.

일반적으로 서버는 다른 피어를 찾기 위해 공개 허브에 단 한 번 연결하면 됩니다. 이후에는 네트워크 연결의 안정성, 허브의 바쁨, 그리고 서버가 찾은 다른 고품질 피어의 수에 따라 허브에 대한 연결을 유지하거나 끊을 수 있습니다. 서버는 다른 피어들의 주소를 저장하여 네트워크 중단이나 재시작 후에 해당 피어들에 직접 재연결을 시도할 수 있습니다.

[peers 메소드](../../references/http-websocket-apis/api-2/undefined-4/peers.md)는 현재 서버에 연결된 피어들의 목록을 보여줍니다.

특정한 중요한 [검증](rippled.md) 등과 같은 고부가 가치 서버의 경우, 서버가 피어 검색 과정을 통해 신뢰할 수 없는 피어에 연결되지 않도록 하는 것이 선호될 수 있습니다. 이 경우, 서버를 [개인 피어](undefined-1.md#undefined-3)만 사용하도록 구성할 수 있습니다.

## 피어 프로토콜 포트&#x20;

XRP Ledger에 참여하기 위해, <mark style="background-color:yellow;">rippled</mark> 서버는 피어 프로토콜을 사용하여 임의의 피어에 연결합니다. (현재 서버와 [클러스터링된](undefined.md) 경우를 제외하고 모든 피어는 신뢰할 수 없는 것으로 처리됩니다.)

이상적으로, 서버는 피어 프로토콜을 통해 연결을 보내고 받을 수 있어야 합니다. [방화벽을 통해 피어 프로토콜에 사용되는 포트](../../tutorials/rippled/undefined/undefined-3.md)를 <mark style="background-color:yellow;">rippled</mark> 서버로 전달해야 합니다.

IANA는 XRP Ledger 피어 프로토콜을 위해 [포트 2459를 할당했지만](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml?search=2459), 레거시 시스템과의 호환성을 위해 [기본 rippled config 파일은](https://github.com/XRPLF/rippled/blob/master/cfg/rippled-example.cfg) 모든 네트워크 인터페이스에서 들어오는 피어 프로토콜 연결을 **포트 51235**에서 수신 대기합니다. 서버를 실행하는 경우, <mark style="background-color:yellow;">rippled.cfg</mark> 파일을 사용하여 서버가 수신 대기할 포트를 구성할 수 있습니다.

&#x20;예시：

```json
[port_peer]
port = 2459
ip = 0.0.0.0
protocol = peer
```

피어 프로토콜 포트는 [특수 피어 포트 메소드](../../references/http-websocket-apis/api-2/undefined-6/)도 제공합니다.

## 노드 키 쌍&#x20;

서버가 처음 시작될 때, 피어 프로토콜 통신에서 자신을 식별하기 위해 노드 키 쌍을 생성합니다. 서버는 이 키를 사용하여 모든 피어 프로토콜 통신에 서명합니다. 이를 통해 신뢰할 수 없는 피어를 통해 서버의 메세지가 중계되는 경우에도 P2P 네트워크의 다른 서버의 메시지 무결성을 안정적으로 식별하고 검증할 수 있습니다.

노드 키 쌍은 데이터베이스에 저장되고 서버가 재시작할 때 재사용됩니다. 데이터베이스를 삭제하면 새로운 노드 키 쌍이 생성되어 다른 식별 정보로 온라인에 나타납니다. 데이터베이스가 삭제되더라도 동일한 키 쌍을 재사용하려면 서버를 <mark style="background-color:yellow;">\[node\_seed]</mark> 구절로 구성할 수 있습니다. <mark style="background-color:yellow;">\[node\_seed]</mark> 구절에 사용할 수 있는 값을 생성하려면 [validation\_create 메소드](../../references/http-websocket-apis/api-2/undefined/validation\_create.md)를 사용하세요.

노드 키 쌍은 [클러스터링](undefined.md)이나 [피어 슬롯 예약과 같은](undefined-1.md#fixed-peers-peer-reservations) 다른 서버의 식별에도 사용됩니다. 서버 클러스터를 가지고 있다면 클러스터의 각 서버를 고유한 <mark style="background-color:yellow;">\[node\_seed]</mark> 설정으로 구성해야 합니다. 클러스터 설정에 대한 자세한 내용은 "[Cluster rippled Servers](../../tutorials/rippled/undefined/rippled.md)"를 참조하세요.

## 고정 피어(Fixed Peers) 및 피어 예약(Peer Reservations)

일반적으로 <mark style="background-color:yellow;">rippled</mark> 서버는 정상적 수의 피어를 유지하려고 노력하며, 최대 수의 신뢰할 수 없는 피어에 자동으로 연결합니다. <mark style="background-color:yellow;">rippled</mark> 서버를 특정 피어 서버에 계속 연결되도록 구성하는 방법은 다음과 같습니다:

* **고정된 피어**를 사용하여 특정 다른 피어와 IP 주소를 기반으로 항상 연결된 상태를 유지합니다. 이는 피어의 IP 주소가 고정된 경우에만 작동합니다. 고정된 피어는 \[ips\_fixed] 설정 stanza를 사용하여 구성합니다. 이는 클러스터링이나 개인 피어의 필수 요소입니다. 고정된 피어는 설정 파일에서 정의되며, 변경 사항은 서버를 재시작한 후에 적용됩니다. 같은 개인 또는 조직에서 운영하는 서버를 연결하는 데 가장 유용합니다.
* **피어 예약**을 사용하여 특정 피어에 우선순위를 부여할 수 있습니다. 서버에 특정 피어에 대한 피어 예약이 있는 경우, 서버는 이미 최대 연결 피어 수에 도달한 경우에도 해당 피어의 연결 요청을 항상 수락합니다. (이로 인해 서버는 최대 피어 수를 초과할 수 있습니다.) [노드 키 쌍](undefined-1.md#undefined-2)으로 예약된 피어를 식별하므로 IP 주소가 가변되는 피어에 대해서도 이 작업을 수행할 수 있습니다. 피어 예약은 관리자 명령을 통해 구성되며 서버 데이터베이스에 저장되어 온라인에서 조정할 수 있으며 재시작 후에도 유지됩니다. 피어 예약은 서로 다른 사람이나 조직에서 운영하는 서버를 연결하는 데 가장 유용합니다. [![New in: rippled 1.4.0](https://img.shields.io/badge/New%20in-rippled%201.4.0-blue.svg)](https://github.com/ripple/rippled/releases/tag/1.4.0)

다음의 경우에는 <mark style="background-color:yellow;">rippled</mark> 서버가 신뢰할 수 없는 피어에 연결하지 않습니다:

* 서버가 [개인 피어](undefined-1.md#undefined-3)로 구성된 경우, 고정된 피어에만 연결합니다.&#x20;
* 서버가[ stand-alone 모드](rippled.md)로 실행 중인 경우, _어떤_ 피어에도 연결하지 않습니다.

## 개인 피어&#x20;

IP 주소를 일반 대중으로부터 숨기기 위해 <mark style="background-color:yellow;">rippled</mark> 서버를 "개인" 서버로 구성할 수 있습니다. 이는 서비스 거부 공격이나 신뢰할 수 있는 검증인과 같은 중요한 <mark style="background-color:yellow;">rippled</mark> 서버로부터의 침입 시도로부터의 예방 조치로 유용할 수 있습니다. 개인 서버는 P2P 네트워크에 참여하려면 적어도 하나의 비공개 서버에 연결되도록 구성되어야 합니다. 개인 서버는 비-개인 서버로부터 메시지를 전달하여 네트워크의 나머지로 메시지를 중계합니다.

{% hint style="info" %}
Caution:

[고정된 피어](undefined-1.md#fixed-peers-peer-reservations)가 없는 개인 서버를 구성하면 서버가 네트워크에 연결할 수 없으므로 네트워크 상태를 알 수 없으며, 트랜잭션을 브로드캐스트하거나 컨센서스 프로세스에 참여할 수 없습니다.
{% endhint %}

서버를 개인 서버로 구성하는 것은 다음과 같은 효과가 있습니다:

* 서버는 명시적으로 해당 서버에 연결하기로 구성되지 않은 한 P2P 네트워크의 다른 서버에 대한 발신 연결을 생성하지 않습니다.&#x20;
* 서버는 다른 서버의 연결을 허용하도록 명시적으로 구성되지 않은 경우 다른 서버의 수신 연결을 허용하지 않습니다.
* 서버는 비신뢰적인 통신을 포함한 자신의 직접 [피어 크롤러 API 응답](../../references/http-websocket-apis/api-2/undefined-6/undefined-1.md)을 포함하는 신뢰되지 않은 통신들에서 자신의 IP 주소를 공개하지 않도록 요청합니다. 이는 [피어 관리자 메소드](../../references/http-websocket-apis/api-2/undefined-4/peers.md)와 같은 신뢰할 수 있는 통신에는 영향을 주지 않습니다.\
  검증인은 개인 서버 설정에 관계없이 항상 자신의 피어가 그들의 IP 주소를 숨기도록 요청합니다. 이는 서비스 거부 공격에 의한 과부하로부터 검증인 보호하는 데 도움이 됩니다. [![New in: rippled 1.2.1](https://img.shields.io/badge/New%20in-rippled%201.2.1-blue.svg)](https://github.com/ripple/rippled/releases/tag/1.2.1)

{% hint style="info" %}
Caution:

개인 서버의 소스 코드를 수정하여 이 요청을 무시하고 즉시 피어의 IP 주소를 공유하는 것이 가능합니다. 개인 서버를 구성할 때 이와 같이 수정되지 않은 서버에만 연결하도록 구성해야 합니다.
{% endhint %}

## 피어링 구성의 장단점

XRP Ledger에 참여하기 위해서는 rippled 서버가 개방된 P2P 네트워크의 나머지 부분에 연결되어야 합니다. 대략적으로 rippled 서버가 네트워크에 어떻게 연결되는지에 대해 세 가지 구성 카테고리가 있습니다:

* **검색된 피어**를 사용합니다. 서버가 적절하게 동작하는 한 서버는 찾은 신뢰할 수 없는 서버에 연결하고 연결 상태를 유지합니다. (예를 들어, 너무 많은 데이터를 요청하지 않고, 네트워크 연결이 안정적이며, 같은 네트워크를 따르는 것으로 보입니다.) 이것이 기본 설정입니다.
* **동일한 개인 또는 조직이 운영하는 프록시**를 사용하는 비공개 서버입니다. 프록시는 개인 서버와 고정 피어링 연결을 유지하는 스톡 <mark style="background-color:yellow;">rippled</mark> 서버(검색된 피어에도 연결됨)입니다.
* **공개 허브를 사용하는 개인 서버**입니다. 이것은 프록시를 사용하는 것과 유사하지만 특정 제3자에 의존합니다.

각 구성의 장단점은 다음과 같습니다:

| 구성               | 장점                                                                                                                                                                                                                                                                                                                         | 단점                                                                                                                                                                                                                                                                                   |
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 검색된 피어           | <ul><li>유지 관리 부담이 적은 가장 간단한 구성입니다.</li><li>직접적인 피어 연결의 기회를 많이 만들어줍니다. 더 많은 직접적인 피어를 가지는 것에는 여러 가지 이점이 있습니다. 서버는 동기화 및 히스토리 백필링 시에 여러 피어로부터 히스토리를 병렬로 가져올 수 있습니다. 모든 피어가 전체 히스토리를 유지하지 않기 때문에 더 많은 피어에 액세스하면 더 많은 다양한 과거 데이터에 액세스할 수도 있습니다.</li><li>서버가 연결이 끊긴 피어를 새로운 피어로 대체할 수 있기 때문에 네트워크와의 연결이 끊길 가능성이 낮아집니다.</li></ul> | <ul><li>서버의 피어를 직접 선택할 수 없기 때문에 피어가 악의적으로 행동할 수 있는지 여부를 알 수 없습니다. <code>rippled</code> 서버는 악의적인 피어에 대한 보호를 위해 설계되었지만, 악의적인 피어가 소프트웨어 결함을 이용하여 서버에 영향을 줄 수 있는 위험이 항상 존재합니다. </li><li>서버의 피어는 자주 연결이 끊어지거나 변경될 수 있습니다.</li></ul>                                                       |
| 프록시를 사용하는 개인 서버  | <ul><li>효과적으로 구현할 때 가장 안전하고 신뢰할 수 있는 구성입니다.</li><li>구현 방식에 따라 신뢰성과 중복성을 달성할 수 있습니다.</li><li>클러스터링을 통해 개인 서버의 성능을 최적화할 수 있습니다.</li><li>원하는 만큼 많은 직접적인 피어 연결을 생성할 수 있습니다. 개인 서버는 여러 피어로부터 히스토리를 병렬로 가져올 수 있습니다. 피어를 직접 운영하기 때문에 각 피어가 유지하는 ledger 히스토리의 양을 제어할 수도 있습니다.</li></ul>                                            | <ul><li>여러 개의 서버를 실행하는 것으로 인해 유지 보수 부담과 비용이 증가합니다.</li><li>피어 연결 중단 가능성을 완전히 제거하지는 못합니다. 모든 프록시가 동일한 서버 rack에 존재할 경우네트워크 또는 전원 장애가 발생하면 모든 프록시에 영향을 줄 수 있습니다.</li></ul>                                                                                                              |
| 공 허브를 사용하는 개인 서버 | <ul><li>적은 양의 구성으로 유지관리 부담이 적습니다.</li><li>네트워크로 안전한 연결에 액세스할 수 있습니다.</li><li>프록시를 사용하여 연결하는 것과 비교하여 동시에 여러 피어가 연결이 끊겨도 개인 서버가 네트워크와의 연결이 끊길 가능성이 상대적으로 적을 수 있습니다.</li></ul>                                                                                                                                                | <ul><li><p>신뢰성을 유지하기 위해 신뢰할 수 있는 제 3자에게 의존합니다.</p><p></p></li><li>사용하는 공개 허브가 너무 바쁜 경우 개인 서버가 네트워크와의 연결이 끊길 수 있습니다. 공개 허브의 특성상 가장 인기가 많기 때문에 모든 사람에게 안정적인 연결을 유지할 수 없을 수 있습니다.</li><li>이 문제를 피하기 위해 가능한 많은 공 허브를 사용하는 것이 좋습니다. 또한, 바쁘지 않은 기본 이외의 허브를 사용하는 것도 도움이 될 수 있습니다.</li></ul> |

## 개인 서버 구성

개인 서버로 서버를 구성하려면 구성 파일에서 <mark style="background-color:yellow;">\[peer\_private]</mark> 설정을 <mark style="background-color:yellow;">1</mark>로 설정하십시오. 자세한 지침은 [비공개 서버 구성](../../tutorials/rippled/undefined/undefined.md)을 참조하십시오.
