# 불변성 체크

불변성 체크는 XRP Ledger의 안전 기능입니다. 이는 일반 트랜잭션 처리와 별도로 실행되는 일련의 체크로, 모든 트랜잭션에서 특정한 _불변성_이 유지되도록 보장합니다.

많은 안전 기능과 마찬가지로, 우리는 불변성 체크가 실제로 동작할 필요가 없기를 바랍니다. 그러나 XRP Ledger의 불변성을 이해하는 것은 중요합니다. 왜냐하면 이 불변성은 XRP Ledger의 트랜잭션 처리에 엄격한 제한을 정의하며, 트랜잭션이 불변성 체크를 위반하여 실패하는 경우의 문제를 인식하는 데 도움이 됩니다.

불변성 체크는 아직 발견되지 않은 버그로부터 XRP Ledger의 무결성을 보호합니다.

## 존재 이유&#x20;

* XRP Ledger의 소스 코드는 복잡하고 방대합니다. 코드가 잘못 실행될 가능성이 매우 높습니다.&#x20;
* 트랜잭션을 잘못 실행하는 비용은 매우 크며 어떤 기준에서도 허용되지 않습니다.&#x20;

특히 잘못된 트랜잭션 실행은 유효하지 않거나 손상된 데이터를 생성하여 서버를 "불가능한" 상태로 보내 전체 네트워크를 중단시킬 수 있습니다.

잘못된 트랜잭션 처리는 XRP Ledger에 대한 신뢰의 가치를 훼손시킬 수 있습니다. 불변성 체크는 XRP Ledger 전체에 신뢰성이라는 기능을 추가함으로써 XRP Ledger에 가치를 제공합니다.

## 작동 방식&#x20;

불변성 체커는 트랜잭션 이후 실시간으로 자동으로 실행되는 두 번째 계층의 코드입니다. 트랜잭션의 결과가 ledger에 커밋되기 전에 불변성 체커는 이러한 변경 사항을 정확성에 대해 검사합니다. 트랜잭션의 결과가 XRP Ledger의 엄격한 규칙 중 하나를 위반한다면 불변성 체커는 해당 트랜잭션을 거부합니다. 이러한 방식으로 거부된 트랜잭션은 결과 코드 <mark style="background-color:yellow;">tecINVARIANT\_FAILED</mark>를 갖고 효과를 미치지 않고 ledger에 포함됩니다.

<mark style="background-color:yellow;">tec</mark>-클래스 코드로 트랜잭션을 ledger에 포함시키기 위해서는 일부 최소한의 처리가 필요합니다. 그러나 이 최소한의 처리조차도 불변성을 위반한다면 트랜잭션은 대신 코드 <mark style="background-color:yellow;">tefINVARIANT\_FAILED</mark>로 실패하며 ledger에 전혀 포함되지 않습니다.

## 불변성 활성

XRP Ledger는 모든 트랜잭션에서 다음과 같은 불변성을 확인합니다:

* [트랜잭션 수수료 체크.](undefined-3.md#undefined-3)
* [XRP 생성 금지.](undefined-3.md#xrp)
* [계정 루트 삭제 금지. ](undefined-3.md#undefined-4)
* [XRP 잔고 체크.](undefined-3.md#xrp-1)
* [ledger 항목 유형 일치.](undefined-3.md#ledger)
* [XRP 신뢰선 없음.](undefined-3.md#xrp-2)
* [잘못된 제안 없음.](undefined-3.md#undefined-5)
* [0 XRP 에스크로 금지.](undefined-3.md#0-xrp)
* [유효한 새 계정 루트. ](undefined-3.md#undefined-6)

## 트랜잭션 수수료 체크

* **불변성 조건:**
  * 트랜잭션 비용 금액은 음수일 수 없으며, 트랜잭션에서 지정된 비용보다 크지 않아야 합니다.

## XRP 생성 금지&#x20;

* **불변성 조건:**&#x20;
  * 트랜잭션은 XRP를 생성해서는 안되며, XRP 트랜잭션 비용만 소멸시켜야 합니다.&#x20;

## 계정 루트 삭제 금지&#x20;

* **불변성 조건:**&#x20;
  * AccountDelete 트랜잭션을 통해서만 계정을 ledger에서 삭제할 수 있습니다.
  * 성공적인 AccountDelete 트랜잭션은 정확히 1개의 계정을 삭제합니다.&#x20;

## XRP 잔고 체크&#x20;

* **불변성 조건:**&#x20;
  * 계정의 XRP 잔고는 XRP 유형이어야 하며, 0보다 작거나 1,000억 XRP보다 크지 않아야 합니다.&#x20;

## Ledger 항목 유형 일치&#x20;

* **불변성 조건:**&#x20;
  * 해당 수정된 ledger 항목은 유형이 일치해야 하며, 추가된 항목은 유효한 유형이어야 합니다.&#x20;

## XRP 신뢰선 없음&#x20;

* **불변성 조건:**&#x20;
  * XRP를 사용한 신뢰선은 허용되지 않습니다.&#x20;

## 잘못된 제안 없음&#x20;

* **불변성 조건:**&#x20;
  * 제안은 음수 금액에 대한 것이어서는 안되며, XRP에서 XRP로 제안되어서도 안 됩니다.&#x20;

## 0 XRP 에스크로 금지&#x20;

* **불변성 조건:**&#x20;
  * 에스크로 항목은 0보다 크고 1,000억 XRP보다 작아야 합니다.&#x20;

## 유효한 새 계정 루트&#x20;

* **불변성 조건:**&#x20;
  * 새 계정 루트는 결제의 결과여야 합니다.&#x20;
  * 새 계정 루트는 올바른 시작 시퀀스를 가져야 합니다.&#x20;
  * 트랜잭션은 하나 이상의 새 계정을 생성해서는 안 됩니다.

## ValidNFTokenPage&#x20;

* **불변성 조건:**&#x20;
  * 발행 또는 소각된 NFT의 수는 NFTokenMint 또는 NFTokenBurn 트랜잭션으로만 변경할 수 있습니다.&#x20;
  * NFTokenMint 트랜잭션이 성공하면 NFT의 수가 증가해야 합니다.&#x20;
  * 실패한 NFTokenMint 트랜잭션은 발행된 NFT의 수를 변경하지 않아야 합니다.
  * NFTokenMint 트랜잭션은 소각된 NFT의 수를 변경할 수 없습니다.&#x20;
  * NFTokenBurn 트랜잭션이 성공하면 소각된 NFT의 수가 증가해야 합니다.&#x20;
  * 실패한 NFTokenBurn 트랜잭션은 소각된 NFT의 수를 변경하지 않아야 합니다.&#x20;
  * NFTokenBurn 트랜잭션은 발행된 NFT의 수를 변경할 수 없습니다.&#x20;

## NFTokenCountTracking&#x20;

* **불변성 조건:**&#x20;
  * 페이지가 소유자와 올바르게 연결되었습니다. -
  * 페이지가 다음 링크와 이전 링크 사이에 올바르게 정렬되어 있습니다.&#x20;
  * 페이지에 유효한 수의 NFT가 포함되어 있습니다.&#x20;
  * 이 페이지의 NFT가 하위 또는 상위 페이지에 속하지 않습니다.&#x20;
  * 페이지에서 NFT가 올바르게 정렬되어 있습니다.&#x20;
  * 각 URI(있는 경우)가 비어 있지 않습니다.
